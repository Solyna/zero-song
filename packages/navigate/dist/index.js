!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@zero-song/hooks")):"function"==typeof define&&define.amd?define(["exports","@zero-song/hooks"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self)["@zero-song/navigate"]={},t.hooks)}(this,(function(t,n){"use strict";function e(){return e=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},e.apply(this,arguments)}var r;!function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"}(r||(r={}));var o="beforeunload",i="popstate";function a(t){t.preventDefault(),t.returnValue=""}function s(){var t=[];return{get length(){return t.length},push:function(n){return t.push(n),function(){t=t.filter((function(t){return t!==n}))}},call:function(n){t.forEach((function(t){return t&&t(n)}))}}}function c(){return Math.random().toString(36).substr(2,8)}function u(t){var n=t.pathname,e=void 0===n?"/":n,r=t.search,o=void 0===r?"":r,i=t.hash,a=void 0===i?"":i;return o&&"?"!==o&&(e+="?"===o.charAt(0)?o:"?"+o),a&&"#"!==a&&(e+="#"===a.charAt(0)?a:"#"+a),e}function l(t){var n={};if(t){var e=t.indexOf("#");e>=0&&(n.hash=t.substr(e),t=t.substr(0,e));var r=t.indexOf("?");r>=0&&(n.search=t.substr(r),t=t.substr(0,r)),t&&(n.pathname=t)}return n}const{route:h={}}=n.useEnv();t.history=void 0;const{type:f="Browser"}=h||{};t.history=f&&"Hash"==f?function(t){void 0===t&&(t={});var n=t.window,h=void 0===n?document.defaultView:n,f=h.history;function d(){var t=l(h.location.hash.substr(1)),n=t.pathname,e=void 0===n?"/":n,r=t.search,o=void 0===r?"":r,i=t.hash,a=void 0===i?"":i,s=f.state||{};return[s.idx,{pathname:e,search:o,hash:a,state:s.usr||null,key:s.key||"default"}]}var v=null;function p(){if(v)m.call(v),v=null;else{var t=r.Pop,n=d(),e=n[0],o=n[1];if(m.length){if(null!=e){var i=w-e;i&&(v={action:t,location:o,retry:function(){W(-1*i)}},W(i))}}else E(t)}}h.addEventListener(i,p),h.addEventListener("hashchange",(function(){u(d()[1])!==u(b)&&p()}));var g=r.Pop,y=d(),w=y[0],b=y[1],$=s(),m=s();function x(t){return function(){var t=document.querySelector("base"),n="";if(t&&t.getAttribute("href")){var e=h.location.href,r=e.indexOf("#");n=-1===r?e:e.slice(0,r)}return n}()+"#"+("string"==typeof t?t:u(t))}function S(t,n){return void 0===n&&(n=null),e({pathname:b.pathname,hash:"",search:""},"string"==typeof t?l(t):t,{state:n,key:c()})}function k(t,n){return[{usr:t.state,key:t.key,idx:n},x(t)]}function P(t,n,e){return!m.length||(m.call({action:t,location:n,retry:e}),!1)}function E(t){g=t;var n=d();w=n[0],b=n[1],$.call({action:g,location:b})}function W(t){f.go(t)}null==w&&(w=0,f.replaceState(e({},f.state,{idx:w}),""));var L={get action(){return g},get location(){return b},createHref:x,push:function t(n,e){var o=r.Push,i=S(n,e);if(P(o,i,(function(){t(n,e)}))){var a=k(i,w+1),s=a[0],c=a[1];try{f.pushState(s,"",c)}catch(t){h.location.assign(c)}E(o)}},replace:function t(n,e){var o=r.Replace,i=S(n,e);if(P(o,i,(function(){t(n,e)}))){var a=k(i,w),s=a[0],c=a[1];f.replaceState(s,"",c),E(o)}},go:W,back:function(){W(-1)},forward:function(){W(1)},listen:function(t){return $.push(t)},block:function(t){var n=m.push(t);return 1===m.length&&h.addEventListener(o,a),function(){n(),m.length||h.removeEventListener(o,a)}}};return L}({window:window}):function(t){void 0===t&&(t={});var n=t.window,h=void 0===n?document.defaultView:n,f=h.history;function d(){var t=h.location,n=t.pathname,e=t.search,r=t.hash,o=f.state||{};return[o.idx,{pathname:n,search:e,hash:r,state:o.usr||null,key:o.key||"default"}]}var v=null;h.addEventListener(i,(function(){if(v)$.call(v),v=null;else{var t=r.Pop,n=d(),e=n[0],o=n[1];if($.length){if(null!=e){var i=y-e;i&&(v={action:t,location:o,retry:function(){E(-1*i)}},E(i))}}else P(t)}}));var p=r.Pop,g=d(),y=g[0],w=g[1],b=s(),$=s();function m(t){return"string"==typeof t?t:u(t)}function x(t,n){return void 0===n&&(n=null),e({pathname:w.pathname,hash:"",search:""},"string"==typeof t?l(t):t,{state:n,key:c()})}function S(t,n){return[{usr:t.state,key:t.key,idx:n},m(t)]}function k(t,n,e){return!$.length||($.call({action:t,location:n,retry:e}),!1)}function P(t){p=t;var n=d();y=n[0],w=n[1],b.call({action:p,location:w})}function E(t){f.go(t)}null==y&&(y=0,f.replaceState(e({},f.state,{idx:y}),""));var W={get action(){return p},get location(){return w},createHref:m,push:function t(n,e){var o=r.Push,i=x(n,e);if(k(o,i,(function(){t(n,e)}))){var a=S(i,y+1),s=a[0],c=a[1];try{f.pushState(s,"",c)}catch(t){h.location.assign(c)}P(o)}},replace:function t(n,e){var o=r.Replace,i=x(n,e);if(k(o,i,(function(){t(n,e)}))){var a=S(i,y),s=a[0],c=a[1];f.replaceState(s,"",c),P(o)}},go:E,back:function(){E(-1)},forward:function(){E(1)},listen:function(t){return b.push(t)},block:function(t){var n=$.push(t);return 1===$.length&&h.addEventListener(o,a),function(){n(),$.length||h.removeEventListener(o,a)}}};return W}({window:window});const{layout:{index:d},appName:v}=n.useEnv();var p=new class{indexPage;constructor(){this.indexPage=v?`/${v}${d||"/index"}`:`${d||"/index"}`,this.initHistory(t.history.location)}initHistory=n=>{if(!n)return;let{pathname:e}=n;("/"===e||v&&(e===`/${v}`||e===`/${v}/`))&&(e=this.indexPage,t.history.push(e))};goTo=(n,e,r)=>(n=n||this.indexPage,String(n).startsWith("/")?(v&&!String(n).startsWith(`/${v}`)&&(n=`/${v}${n}`),r&&r.target?void window.open(`${window.location.protocol}//${window.location.host}${n}`,r.target,""):void t.history.push(n,e)):String(n).startsWith("https:")||String(n).startsWith("http:")?(console.info(`${n}`,"站外跳转"),void window.open(n,r&&r.target||"_self","")):void console.warn(`${n} 不符合规则，无法进行跳转。`));goBack=n=>{n?t.history.go(n):t.history.back()};redirect=(n,e)=>(n=n||this.indexPage,String(n).startsWith("/")?(v&&!String(n).startsWith(`/${v}`)&&(n=`/${v}${n}`),void t.history.replace(n,e)):String(n).startsWith("https:")||String(n).startsWith("http:")?(console.info("站外跳转",`${n}`),void window.location.replace(n)):void console.warn(`${n} 不符合规则，无法进行跳转。`));reload=t=>{t?(String(t).startsWith("https:")||String(t).startsWith("http:")||t&&v&&!String(t).startsWith(`/${v}`)&&(t=`/${v}${t}`),window.location.replace(t||window.location.href)):window.location.reload()}};t.navigate=p}));
//# sourceMappingURL=index.js.map
