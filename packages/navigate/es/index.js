import{useEnv as t}from"@zero-song/hooks";function n(){return n=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},n.apply(this,arguments)}var e;!function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"}(e||(e={}));var r="beforeunload",a="popstate";function i(t){t.preventDefault(),t.returnValue=""}function o(){var t=[];return{get length(){return t.length},push:function(n){return t.push(n),function(){t=t.filter((function(t){return t!==n}))}},call:function(n){t.forEach((function(t){return t&&t(n)}))}}}function c(){return Math.random().toString(36).substr(2,8)}function s(t){var n=t.pathname,e=void 0===n?"/":n,r=t.search,a=void 0===r?"":r,i=t.hash,o=void 0===i?"":i;return a&&"?"!==a&&(e+="?"===a.charAt(0)?a:"?"+a),o&&"#"!==o&&(e+="#"===o.charAt(0)?o:"#"+o),e}function u(t){var n={};if(t){var e=t.indexOf("#");e>=0&&(n.hash=t.substr(e),t=t.substr(0,e));var r=t.indexOf("?");r>=0&&(n.search=t.substr(r),t=t.substr(0,r)),t&&(n.pathname=t)}return n}const{route:l={}}=t();let h;const{type:f="Browser"}=l||{};h=f&&"Hash"==f?function(t){void 0===t&&(t={});var l=t.window,h=void 0===l?document.defaultView:l,f=h.history;function d(){var t=u(h.location.hash.substr(1)),n=t.pathname,e=void 0===n?"/":n,r=t.search,a=void 0===r?"":r,i=t.hash,o=void 0===i?"":i,c=f.state||{};return[c.idx,{pathname:e,search:a,hash:o,state:c.usr||null,key:c.key||"default"}]}var v=null;function p(){if(v)S.call(v),v=null;else{var t=e.Pop,n=d(),r=n[0],a=n[1];if(S.length){if(null!=r){var i=y-r;i&&(v={action:t,location:a,retry:function(){E(-1*i)}},E(i))}}else W(t)}}h.addEventListener(a,p),h.addEventListener("hashchange",(function(){s(d()[1])!==s($)&&p()}));var g=e.Pop,w=d(),y=w[0],$=w[1],m=o(),S=o();function b(t){return function(){var t=document.querySelector("base"),n="";if(t&&t.getAttribute("href")){var e=h.location.href,r=e.indexOf("#");n=-1===r?e:e.slice(0,r)}return n}()+"#"+("string"==typeof t?t:s(t))}function x(t,e){return void 0===e&&(e=null),n({pathname:$.pathname,hash:"",search:""},"string"==typeof t?u(t):t,{state:e,key:c()})}function P(t,n){return[{usr:t.state,key:t.key,idx:n},b(t)]}function k(t,n,e){return!S.length||(S.call({action:t,location:n,retry:e}),!1)}function W(t){g=t;var n=d();y=n[0],$=n[1],m.call({action:g,location:$})}function E(t){f.go(t)}null==y&&(y=0,f.replaceState(n({},f.state,{idx:y}),""));var L={get action(){return g},get location(){return $},createHref:b,push:function t(n,r){var a=e.Push,i=x(n,r);if(k(a,i,(function(){t(n,r)}))){var o=P(i,y+1),c=o[0],s=o[1];try{f.pushState(c,"",s)}catch(t){h.location.assign(s)}W(a)}},replace:function t(n,r){var a=e.Replace,i=x(n,r);if(k(a,i,(function(){t(n,r)}))){var o=P(i,y),c=o[0],s=o[1];f.replaceState(c,"",s),W(a)}},go:E,back:function(){E(-1)},forward:function(){E(1)},listen:function(t){return m.push(t)},block:function(t){var n=S.push(t);return 1===S.length&&h.addEventListener(r,i),function(){n(),S.length||h.removeEventListener(r,i)}}};return L}({window:window}):function(t){void 0===t&&(t={});var l=t.window,h=void 0===l?document.defaultView:l,f=h.history;function d(){var t=h.location,n=t.pathname,e=t.search,r=t.hash,a=f.state||{};return[a.idx,{pathname:n,search:e,hash:r,state:a.usr||null,key:a.key||"default"}]}var v=null;h.addEventListener(a,(function(){if(v)m.call(v),v=null;else{var t=e.Pop,n=d(),r=n[0],a=n[1];if(m.length){if(null!=r){var i=w-r;i&&(v={action:t,location:a,retry:function(){W(-1*i)}},W(i))}}else k(t)}}));var p=e.Pop,g=d(),w=g[0],y=g[1],$=o(),m=o();function S(t){return"string"==typeof t?t:s(t)}function b(t,e){return void 0===e&&(e=null),n({pathname:y.pathname,hash:"",search:""},"string"==typeof t?u(t):t,{state:e,key:c()})}function x(t,n){return[{usr:t.state,key:t.key,idx:n},S(t)]}function P(t,n,e){return!m.length||(m.call({action:t,location:n,retry:e}),!1)}function k(t){p=t;var n=d();w=n[0],y=n[1],$.call({action:p,location:y})}function W(t){f.go(t)}null==w&&(w=0,f.replaceState(n({},f.state,{idx:w}),""));var E={get action(){return p},get location(){return y},createHref:S,push:function t(n,r){var a=e.Push,i=b(n,r);if(P(a,i,(function(){t(n,r)}))){var o=x(i,w+1),c=o[0],s=o[1];try{f.pushState(c,"",s)}catch(t){h.location.assign(s)}k(a)}},replace:function t(n,r){var a=e.Replace,i=b(n,r);if(P(a,i,(function(){t(n,r)}))){var o=x(i,w),c=o[0],s=o[1];f.replaceState(c,"",s),k(a)}},go:W,back:function(){W(-1)},forward:function(){W(1)},listen:function(t){return $.push(t)},block:function(t){var n=m.push(t);return 1===m.length&&h.addEventListener(r,i),function(){n(),m.length||h.removeEventListener(r,i)}}};return E}({window:window});const{layout:{index:d},appName:v}=t();var p=new class{indexPage;constructor(){this.indexPage=v?`/${v}${d||"/index"}`:`${d||"/index"}`,this.initHistory(h.location)}initHistory=t=>{if(!t)return;let{pathname:n}=t;("/"===n||v&&(n===`/${v}`||n===`/${v}/`))&&(n=this.indexPage,h.push(n))};goTo=(t,n,e)=>(t=t||this.indexPage,String(t).startsWith("/")?(v&&!String(t).startsWith(`/${v}`)&&(t=`/${v}${t}`),e&&e.target?void window.open(`${window.location.protocol}//${window.location.host}${t}`,e.target,""):void h.push(t,n)):String(t).startsWith("https:")||String(t).startsWith("http:")?(console.info(`${t}`,"站外跳转"),void window.open(t,e&&e.target||"_self","")):void console.warn(`${t} 不符合规则，无法进行跳转。`));goBack=t=>{t?h.go(t):h.back()};redirect=(t,n)=>(t=t||this.indexPage,String(t).startsWith("/")?(v&&!String(t).startsWith(`/${v}`)&&(t=`/${v}${t}`),void h.replace(t,n)):String(t).startsWith("https:")||String(t).startsWith("http:")?(console.info("站外跳转",`${t}`),void window.location.replace(t)):void console.warn(`${t} 不符合规则，无法进行跳转。`));reload=t=>{t?(String(t).startsWith("https:")||String(t).startsWith("http:")||t&&v&&!String(t).startsWith(`/${v}`)&&(t=`/${v}${t}`),window.location.replace(t||window.location.href)):window.location.reload()}};export{h as history,p as navigate};
//# sourceMappingURL=index.js.map
